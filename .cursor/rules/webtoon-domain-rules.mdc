---
description: 웹툰 도메인 전용 개발 규칙 및 가이드라인
globs: src/app/(webtoon)/**/*,,public/webtoon/*
alwaysApply: false
---

# Requirement

- 월요일 오전 9시에 네이버 웹툰과 카카오 웹툰 API를 호출해 요일별 웹툰 정보를 가져온다. Github Action을 사용해 json 파일로 저장, github에 commit & push 한다.
- 화면의 중앙 하단부에는 원형의 톱니바퀴 버튼이 1/3만 노출된 형태로 표시되고 있다.
  - 톱니바퀴 버튼을 mouseDown > mousemove 한채로 마우스를 좌 또는 우로 드래그해 톱니바퀴를 돌릴 수 있다.
  - 모바일에서는 touchStart > touchMove 한채로 좌 또는 우로 드래그해 톱니바퀴를 돌릴 수 있다.
  - 톱니바퀴 버튼을 mouseup(또는 touchEnd) 하면 Webtoon CoverFlow 영역의 중앙에 배치될 요소의 index를 결정한다. (cardIndex)
  - 톱니바퀴 버튼을 mouseMove(또는 touchMove) 하는 동안, 직전 이벤트와 0.1초(100ms) 이내의 시간 간격으로 X축 절대값 100px 이상의 속도(Velocity)로 움직이면 "fast" 상태로 인지한다. (평상시엔 "normal" 상태) "fast" 상태가 되면 cardIndex를 0으로 초기화한다.
  - 화면 중앙에는 웹툰 정보가 json 파일로 저장되어 파일 내 이미지를 3D 원형 커버 플로우(Cover Flow) UI로 표시한다.
  - 이 UI는 3D 퍼스펙티브(perspective)를 가지며, 중앙의 카드(현재 cardIndex에 해당)가 가장 크고(scale 1) 정면에 표시된다.
    중앙 카드 양옆의 카드들은 마치 원형 궤도를 따라 배치된 것처럼, 중앙에서 멀어질수록 점차 작아지고(scale < 1) 뒤로 물러나며(translateZ) 살짝 안쪽으로 회전(rotateY)된 형태로 표시된다.
    커버 플로우 UI는 모바일은 3개(중앙 1, 좌/우 1개씩), 그 외의 화면(태블릿, 데스크탑)에선 5개(중앙 1, 좌/우 2개씩)의 카드를 표시한다.
  - 커버 플로우 UI의 카드 중 중앙의 카드만 특별하게 hover 가능한 카드이다.
  - 카드의 앞면은 두 빛이 카드를 가운데 두고 빙글빙글 도는 형태로 동작한다. (이미 구현되어 있음, font-side 참조)
  - 카드의 앞면을 hover시 카드가 Y축으로 180도 회전한다.
  - 카드의 뒷면은 웹툰의 플랫폼, 요일, 제목, 작가 정보가 표시되며 웹툰 사이트로 이동하는 링크를 표시한다.
  - 모바일 화면에서는 hover 상호작용 대신 클릭 이벤트로 카드를 뒤집는다.
    - 중앙 카드의 앞면을 클릭하면 뒷면으로 뒤집힌다.
    - 뒤집힌 상태에서 뒷면을 다시 클릭하면 앞면으로 뒤집힌다.
    - 카드가 뒤집힌 상태에서 톱니바퀴를 돌리면 카드는 자동으로 앞면으로 뒤집힌다.
    - 데스크톱/태블릿 화면에서는 기존대로 hover로 카드 뒤집기를 처리한다.
  - 톱니바퀴를 mouseDown > mousemove(또는 touchStart > touchMove) 하는 동안은 hover 할 수 없고, 두 빛이 빙글빙글 도는 효과도 제거된다.
- 톱니바퀴를 mouseDown > mousemove(또는 touchStart > touchMove) 하는 동안 커버플로우는 회전하는 것처럼 보인다.
  - 톱니바퀴를 좌측으로 드래그(xDistance 감소)하면 커버플로우는 좌측으로 회전하고 좌측으로 드래그(xDistance 증가)하면 우측으로 회전한다.
  - 톱니바퀴를 좌측으로 드래그(xDistance 감소)하면 커버플로우는 좌측으로 회전하게 되고 왼쪽의 카드로 갈수록 카드가 점점 작아지고, 기울어진다.
- 톱니바퀴를 mouseup(또는 touchEnd) 하면 최종 cardIndex가 확정되고, 커버플로우 UI의 중앙 카드가 고정된다.
- 톱니바퀴를 빠르게 돌려 "fast" 상태가 되면 1초 동안 커버 플로우 UI의 모든 카드가 스켈레톤 UI로 표시된다. 이후 웹툰 목록을 랜덤하게 다시 셔플하여 표시한다.
- 커버플로우 상단 중앙에 웹툰 필터 컴포넌트가 배치된다.
  - CheckBox와 Avatar로 구성된 필터 컴포넌트 3개가 8px 간격으로 가운데 정렬된다.
  - 각 필터는 type: 'kakao' | 'naver' | 'soon' props를 전달받는다.
  - CheckBox는 UI에 표시되지 않고 체크 상태만 관리한다.
  - Avatar를 클릭하면 체크박스 선택/해제가 토글된다.
  - Avatar가 선택되면 주위에 shadow 효과가 나타나고, 해제되면 사라진다.
  - Avatar src는 type별로 설정된다: kakao(카카오 로고), naver(네이버 로고), soon(public/images/profile.png)
  - 체크박스 선택 시 해당 type이 쿼리스트링으로 설정된다. (예: ?type=kakao)
  - 체크박스 해제 시 쿼리스트링도 함께 제거된다.
- 웹툰 필터링 기능이 제공된다.
  - kakao/naver 필터: 해당 플랫폼의 웹툰만 표시
  - soon 필터: 개인이 선정한 추천 웹툰만 표시 (webtoon/favorites.json 기반)
  - 필터가 선택되지 않은 경우 모든 웹툰을 랜덤하게 표시
- 개인 추천 웹툰(soon 필터)에는 추천 레벨이 표시된다.
  - 카드 앞면 우측 하단에 lucide-react의 Star 아이콘으로 레벨 표시
  - Level 1: 아이콘 표시 안 함
  - Level 2: Star 아이콘 1개
  - Level 3: Star 아이콘 2개
  - Star 아이콘은 채워진 형태(filled)로 표시

# Implementation Detail

- scripts/scrape-webtoon/main.ts에 웹툰 API를 호출해 요일별 웹툰 정보를 가져오는 코드를 정의, Github Action에서 사용한다.
  - scripts/scrape-webtoon/services.ts에서 각 서비스(Naver, Kakao)별 API 로직을 정의한다.
  - json 파일로 github에 commit & push된 파일은 webtoon/webtoons.json 위치에 저장한다.
  ```
    {
        "lastUpdated": string,
        "webtoons": [
            {
            "id": number,
            "title": string,
            "author": string,
            "dayOfWeek": string,
            "link": string,
            "thumbnail": string,
            "platform": "naver" | "kakao"
            },
        ]
    }
  ```
- 웹툰 페이지는 서버 컴포넌트로 작성한다. API route를 사용하여 fs 모듈로 webtoon/webtoons.json를 읽어들이고 데이터를 셔플해 반환한다.
- WheelProvider 내에서 톱니바퀴 버튼과 관련된 상태를 관리하려 한다.
  - isDragging, X축으로 움직인 거리(xDistance), cardIndex, rotationOffset
  - 톱니바퀴 버튼을 mousemove(또는 touchMove) 한채 0.1초 안에 X축으로 절대 값 100px 이상의 속도로 움직였는지 확인하는 로직 ("fast", "normal" 판별)
  - 터치 이벤트 지원: WheelButton 컴포넌트에서 touchStart, touchMove, touchEnd 이벤트 핸들러를 추가한다.
    - touchStart: mouseDown과 동일한 로직 실행 (e.touches[0].clientX로 X좌표 추출)
    - touchMove: mousemove와 동일한 로직 실행 (e.touches[0].clientX로 X좌표 추출, 속도 감지 포함)
    - touchEnd: mouseup과 동일한 로직 실행 (rotationOffset 반올림, cardIndex 확정)
    - 터치 이벤트 핸들러는 preventDefault()를 호출하여 기본 스크롤 동작을 방지한다.
  - CRITICAL: mouseDown > mousemove(또는 touchStart > touchMove) 하는 동안 커버플로우는 부드럽게 회전해야 한다.
    - mousemove(또는 touchMove) 이벤트마다 xDistance 기반으로 rotationOffset을 실시간 계산: xDistance / 45 (소수점 포함)
    - rotationOffset은 커버플로우의 부드러운 회전을 위해 사용되며, 카드들의 transform (translateX, translateY, translateZ) 값이 rotationOffset에 따라 연속적으로 변화한다.
    - 톱니바퀴를 우측으로 드래그(xDistance 증가)하면 rotationOffset이 증가하고, 커버플로우가 우측으로 회전한다.
    - 톱니바퀴를 좌측으로 드래그(xDistance 감소)하면 rotationOffset이 감소하고, 커버플로우가 좌측으로 회전한다.
    - WebtoonCoverFlow 컴포넌트는 드래그 중에 rotationOffset을 기준으로 카드 위치를 계산하여 부드러운 회전 효과를 구현한다.
    - 단, "fast" 상태일 때는 cardIndex를 0으로 고정하고 웹툰 재셔플 로직을 실행한다.
  - mouseup(또는 touchEnd) 시에만 rotationOffset을 Math.round하여 최종 cardIndex를 확정한다.
    - cardIndex = Math.round(rotationOffset)
    - cardIndex가 0보다 작을 경우: (cardIndex % webtoons.length + webtoons.length) % webtoons.length
    - cardIndex가 webtoons.length보다 큰 경우: cardIndex % webtoons.length
  - 중요: 톱니바퀴의 회전(xDistance deg)은 시각적 효과일 뿐, 실제 커버플로우 회전은 rotationOffset 값으로 이루어지고, 최종 확정은 cardIndex 상태로 이루어진다.
  - 스켈레톤 UI는 react-loading-skeleton 라이브러리를 활용한다.
  - 톱니바퀴 버튼 우클릭 기능을 제한한다.
- 모바일 화면 판단 및 카드 뒤집기 처리:
  - src/hooks 폴더에 use-is-mobile.ts 커스텀 훅을 생성한다.
  - window.matchMedia를 사용하여 모바일 화면인지 판단한다. (모바일 기준: max-width: 768px)
  - isMobile 값을 반환하며, 화면 크기 변경 시 실시간으로 업데이트된다.
  - WebtoonCard 컴포넌트에서 use-is-mobile 훅을 사용한다.
  - 모바일 화면(isMobile === true)일 때:
    - hover 이벤트를 비활성화한다.
    - 중앙 카드 클릭 시 rotationY 각도 값을 180도씩 증가시킨다.
    - rotationY 값을 inline style로 적용하여 Y축 회전을 구현한다. (transform: rotateY(${rotationY}deg))
    - 카드는 항상 같은 방향으로 회전하여 자연스러운 뒤집기 효과를 제공한다.
    - rotationY가 360도 이상이 되어도 CSS가 자동으로 처리하므로 값을 초기화하지 않는다.
    - WheelProvider의 isDragging 상태가 true로 변경되면 rotationY를 0으로 초기화한다.
  - 데스크톱/태블릿 화면(isMobile === false)일 때:
    - 기존 hover 이벤트를 유지한다.
    - 클릭 이벤트는 비활성화한다.
- 개인 추천 웹툰 데이터는 webtoon/favorites.json에 저장한다.
  - 파일 구조:
  ```json
  {
    "lastUpdated": "YYYY-MM-DD",
    "favorites": [
      {
        "title": "웹툰 제목",
        "level": 1 | 2 | 3
      }
    ]
  }
  ```
  - level 1: 추천
  - level 2: 강력 추천
  - level 3: 최고 추천
- 웹툰 필터 컴포넌트 구현 (\_components/webtoon-filter 또는 적절한 이름)
  - props: type: 'kakao' | 'naver' | 'soon'
  - @radix-ui/react-checkbox와 @radix-ui/react-avatar 사용
  - useSearchParams 훅으로 쿼리스트링 읽기/쓰기
  - Avatar 클릭 시 체크박스 토글 및 쿼리스트링 업데이트
  - 선택 상태에 따른 shadow 스타일 적용 (예: shadow-lg shadow-[색상])
  - Avatar fallback 텍스트: kakao("K"), naver("N"), soon("S")
- WebtoonCoverFlow 상위 컴포넌트(page.tsx)에 필터 컴포넌트 배치
  - 3개의 필터 컴포넌트를 flex gap-2(8px)로 중앙 정렬
  - 순서: soon, kakao, naver
- API route (/api/webtoons) 쿼리스트링 처리
  - searchParams에서 type 파라미터 추출
  - type='kakao': webtoons.json에서 platform === 'kakao'인 데이터만 필터링
  - type='naver': webtoons.json에서 platform === 'naver'인 데이터만 필터링
  - type='soon': favorites.json과 webtoons.json의 title 기준 교집합 필터링 후 level 정보 추가
    - 응답 데이터에 recommendLevel 필드 추가
    - level 높은 순 정렬 (3 > 2 > 1), 같은 level은 title 알파벳순
  - type 미지정: 전체 웹툰 셔플하여 반환
- WheelProvider에서 fetchWebtoons 호출 시 쿼리스트링 전달
  - useSearchParams로 현재 type 파라미터 읽기
  - queryFn에서 type을 URL에 포함하여 API 호출
  - type 변경 시 자동으로 refetch 되도록 queryKey에 type 포함
- Webtoon 타입 정의 확장 (\_types/webtoon.ts)
  ```typescript
  export type Webtoon = {
    id: number;
    title: string;
    author: string;
    dayOfWeek: string;
    link: string;
    thumbnail: string;
    platform: 'naver' | 'kakao';
    recommendLevel?: 1 | 2 | 3; // soon 필터링 시에만 존재
  };
  ```
- WebtoonCard FrontSide 컴포넌트에 추천 레벨 표시
  - webtoon.recommendLevel이 2 이상일 때만 Star 아이콘 렌더링
  - lucide-react의 Star 컴포넌트 사용 (fill="currentColor")
  - 카드 우측 하단 절대 위치 배치 (absolute bottom-2 right-2)
  - 아이콘 개수: recommendLevel - 1 (level 2 → 1개, level 3 → 2개)
  - 아이콘 색상: text-yellow-400 또는 적절한 강조 색상
  - 아이콘 크기: 16px~20px

# Constraint

- 웹툰 커버플로우 UI 구현시 외부 슬라이드 라이브러리를 사용하지 않고 JS, Tailwind CSS, CSS in JS를 이용하여 직접 구현한다.
- 클라이언트 전역 상태 관리 라이브러리를 도입하지 않고 필요하다면 contextAPI를 사용한다.

# Acceptance Tests

- Github Action 스크립트(scripts/scrape-webtoon/main.ts)가 매일 오전 9시에 성공적으로 실행된다.
- 실행 후 webtoon/webtoons.json 파일이 Implementation Detail에 정의된 JSON 형식에 맞게 github에 정상적으로 commit & push 된다.
- (수동) 톱니바퀴 버튼을 좌우로 드래그하는 동안 커버플로우가 실시간으로 회전하며 중앙 카드가 즉시 변경된다. mouseup 시 최종 위치에서 멈춘다.
- (수동) 모바일에서 톱니바퀴 버튼을 터치하여 좌우로 드래그하는 동안 커버플로우가 실시간으로 회전하며 중앙 카드가 즉시 변경된다. touchEnd 시 최종 위치에서 멈춘다.
- (수동) 모바일에서 톱니바퀴를 빠르게(fast 상태 기준) 터치 드래그하면 1초간 스켈레톤 UI가 표시된 후, 웹툰 목록이 랜덤하게 재배치된다.
- (수동) 모바일에서 톱니바퀴를 터치 드래그하는 동안 페이지 스크롤이 발생하지 않는다.
- (수동) 데스크톱/태블릿 화면에서 커버 플로우 중앙에 위치한 카드를 hover하면 카드가 뒤집히며 뒷면의 정보(플랫폼, 요일, 제목, 작가, 링크)가 표시된다.
- (수동) 모바일 화면에서 중앙 카드를 클릭하면 카드가 Y축으로 180도 회전하여 뒷면으로 뒤집히고, 다시 클릭하면 Y축으로 추가로 180도 회전(총 360도)하여 앞면으로 뒤집힌다. 카드는 항상 같은 방향으로 회전한다.
- (수동) 모바일 화면에서 카드가 뒤집힌 상태로 톱니바퀴를 돌리면 카드가 자동으로 앞면으로 초기화(rotationY: 0)된다.
- (수동) 톱니바퀴 버튼을 빠르게(fast 상태 기준) 돌리면 1초간 스켈레톤 UI가 표시된 후, 웹툰 목록이 랜덤하게 재배치된다.
- (수동) 톱니바퀴를 드래그하는 동안에는 중앙 카드를 hover해도 뒤집히지 않으며, 빛나는 효과도 사라진다.
- (수동) 커버플로우 상단에 3개의 Avatar 필터(soon, kakao, naver)가 8px 간격으로 가운데 정렬되어 표시된다.
- (수동) 각 Avatar를 클릭하면 shadow 효과가 나타나고 URL 쿼리스트링에 해당 type이 추가된다.
- (수동) 선택된 Avatar를 다시 클릭하면 shadow 효과가 사라지고 쿼리스트링도 제거된다.
- (수동) kakao Avatar 선택 시 카카오 웹툰만 커버플로우에 표시된다.
- (수동) naver Avatar 선택 시 네이버 웹툰만 커버플로우에 표시된다.
- (수동) soon Avatar 선택 시 favorites.json에 등록된 웹툰만 커버플로우에 표시된다.
- (수동) soon 필터 선택 시 level 2 웹툰은 카드 앞면 우측 하단에 Star 아이콘 1개가 표시된다.
- (수동) soon 필터 선택 시 level 3 웹툰은 카드 앞면 우측 하단에 Star 아이콘 2개가 표시된다.
- (수동) soon 필터 선택 시 level 1 웹툰은 Star 아이콘이 표시되지 않는다.
- (수동) 필터를 선택하지 않은 상태에서는 모든 웹툰이 랜덤하게 표시되며 Star 아이콘이 표시되지 않는다.
- (수동) 필터를 선택하지 않은 경우 Star 아이콘이 표시되지 않는다.
